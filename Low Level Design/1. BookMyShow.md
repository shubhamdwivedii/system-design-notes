# BookMyShow Low Level Design 

**See BookMyShow System Design First** 


## The Flow: 

1. User visits the BMS, selects location (city). Default location suggested by browser's location. 

2. User selects the **movie** (from recommendation or search). 

3. Sees **list of theatres** in city playing movies along with different **show** times. 

4. User selects a particular **show** and views the available **seats**. 

5. User selects an available **seat**, (**seat** is temporarily **locked** for the user ~ 10 min). If user can't pay/book seat in 10 minutes the seat will be **released** for other aggregators. 

6. User performs payment through payment gateway. App server gets notified about successful payment and sends a **notification to user**

7. A **ticket (with unique ID)** is generated and sent to user via email. 

8. Ticket will be scanned at theatere (ticket has a **unique QR-code**)


## APIs Needed 

- **GetListOfCities()**
- **GetMoviesByCity(CityId)** 
- **GetTheatresByCity(CityId)** 
- **GetTheatresByMovieAndCity(CityId, MovieId)** 
- **GetShows(TheatreId, MovieId)** _includes timings_ 
- **GetSeats(ShowId)** _both available and unavailable_
- **BlockSeatsForUser([]SeatId, UserId)** 
- **BookSeats(BlockId or []SeatId, UserId)** _called when payment successfull_
- **RealeaseSeats(BlockId or []SeatId, UserId)** _called when payment fails or timeout_

## RDBMS Tables 

**City** 
    name 
    code (pk)

**Theatre** 
    id (pk)
    name 
    city_code (fk)

**Screen** 
    id (pk)
    code 
    theatre_id (fk)

**Tier** (tier of seats in screen)
    id (pk)
    code 
    title 
    screen_id (fk)

**Seat** 
    id (pk)
    code 
    tier_id (fk)
    screen_id (fk)
    booked? 

**Show** 
    id (pk)
    screen_id (fk)
    

**Movie** 
    id (pk)
    title 
    year 
    created_at 
